/*! psdle 4.2.2 (c) RePod, MIT https://github.com/RePod/psdle/blob/master/LICENSE - min - compiled 2024-10-14 */
var repod={};repod.psdle={config:{version:"4.2.2",versionDate:"2024-10-14"},init:function(){console.log(`PSDLE ${this.config.version} ${this.config.versionDate}`),Object.assign(this.config,{root:repod.psdle,userData:{},gameList:[],locale:__NEXT_DATA__.props.appProps.session.userData.locale,gqlHost:__NEXT_DATA__.runtimeConfig.service.gqlBrowser.host,DOMElements:{collectionFilter:"div[data-qa=collection-filter]",filterExportContainer:"psdle-filter-section-export",filterExportSelects:"psdle-filter-export-selects",PSDLEconfigurator:"psdle-configurator"},propCache:[],catalogCache:{},catalogProps:[],catalogDatabase:this.database}),this.config.lang=this.language.getCurrent(this.config),this.css(),this.userData.init(this.config),this.reactisms.init(this.config),this.reactisms.stateChange.callback(this.config)},postInit:async function(e){e.gameList=await this.api.games(e,this.reactisms.getCurrentPage()),this.caches.props(e),this.generate.filters.section(e),e.userData.catalog&&this.api.init(e)},database:{version:1,name:"PSDLECatalogCache",db:{},init:async function(e,t){await this.persist()&&(e.userData.catalog=!0,e.root.userData.save(e),this.create.db(e,t))},persist:function(){return!(!navigator.storage||!navigator.storage.persist)&&navigator.storage.persist().then(function(e){return e})},drop:function(){this.db.hasOwnProperty("close")&&this.db.close();var e=window.indexedDB.deleteDatabase(this.name);e.onsuccess=(e=>console.log(e)),e.onerror=(e=>console.error(e)),location.reload()},create:{db:function(e,t){var o=window.indexedDB.open(e.catalogDatabase.name,e.catalogDatabase.version);o.onerror=(e=>console.error(e)),o.onupgradeneeded=function(t){e.catalogDatabase.db=o.result,e.catalogDatabase.create.upgrade(e,t,o.result)},o.onsuccess=function(r){e.catalogDatabase.db=o.result,t()}},upgrade:function(e,t,o){t.oldVersion>0&&t.oldVersion<e.catalogDatabase.version&&o.deleteObjectStore("cache"),this.objectStore(e,o)},objectStore:function(e,t){(t=t.createObjectStore("cache",{keyPath:"id"})).createIndex("ID","id",{unique:!0}),t.transaction.oncomplete=(e=>console.log(e)),t.transaction.onerror=(e=>console.log(e))}},transact:{get:function(e,t){return e.catalogDatabase.db.transaction("cache",t)},dumpCacheToDB:function(e,t,o){var r=this.get(e,"readwrite"),n=r.objectStore("cache");for(var[a,s]of(r.oncomplete=function(r){o?e.catalogDatabase.transact.dumpDBToCache(e,t):t(r)},r.onerror=(e=>console.log(e)),Object.entries(e.catalogCache)))n.put({id:a,json:s})},dumpDBToCache:function(e,t){var o=this.get(e),r=o.objectStore("cache"),n={};o.oncomplete=(e=>t(e)),o.onerror=(e=>console.log(e)),r.openCursor().onsuccess=function(t){var o=t.target.result;o?(n[o.key]=o.value.json,o.continue()):e.catalogCache=Object.assign({},n)}},getNewIDs:function(e,t){var o=e.gameList.map(e=>e.entitlementId),r=this.get(e,"readonly"),n=r.objectStore("cache"),a=[];r.onerror=(e=>console.log(e)),n.openCursor().onsuccess=function(e){var r=e.target.result;if(r)a.push(r.key),r.continue();else{var n=o.filter(e=>a.indexOf(e)<0);console.debug("Catalog new IDs:",n),t(n)}}}}},reactisms:{init:function(e){this.stateChange.newPushState(e)},getCurrentPage:function(e){return(this.stateChange.tracked||location.pathname).replace(/^\//,"")},stateChange:{tracked:"",timer:0,orgPushState:window.history.pushState,newPushState:function(e){!function(e,t,o){window.history.pushState=function(){t.apply(this,arguments),o.bind(e.root.reactisms.stateChange)(e,arguments)}}(e,this.orgPushState,this.callback)},callback:function(e,t){this.tracked=location.pathname,this.waitForPage(e,e.root.postInit.bind(e.root))},waitForPage:function(e,t){clearInterval(e.root.reactisms.stateChange.timer),this.timer=setInterval(function(){null!=document.querySelector(e.DOMElements.collectionFilter)?(document.querySelectorAll(`${e.DOMElements.collectionFilter} .psw-radio`).forEach(t=>t.addEventListener("click",t=>e.root.reactisms.stateChange.callback(e))),clearInterval(e.root.reactisms.stateChange.timer),t(e)):console.log('PSDLE casts "Spin Wheels" on',location.href)},125)}}},caches:{regen:function(e,t){},props:function(e){let t=["__typename","webctas","conceptId"];if(Object.assign(e,{propCache:e.gameList.map(e=>Object.keys(e)).reduce((e,t)=>t).concat(["empty","sortedIndex"])}),Object.keys(e.catalogCache).length>0){let t=[],o=Object.entries(e.catalogCache).filter(e=>null!==e[1]).reduce((e,t)=>Object.keys(t[1])).concat(t);e.catalogProps=o,e.propCache=e.propCache.concat(o)}else{let t=e.userData.exports.map(e=>e.property).filter(t=>e.propCache.indexOf(t)<0);e.catalogProps=t}e.propCache=e.propCache.filter(function(t,o){var r=e.propCache.indexOf(t)==o;return r||console.warn("Dupe in propCache:",t),r}).filter(e=>t.indexOf(e)<0).sort(),Object.keys(e.catalogCache).length>0&&e.root.exportView.section.refresh(e)}},userData:{key:"PSDLEuserData",defaults:{catalog:!1,exports:[{property:"name",title:"Name"},{property:"platform",title:"Platform"},{property:"sortedIndex",title:"Date (relative)"}]},init:function(e){e.userData=Object.assign({},this.defaults),console.debug(this.load(e))},save:function(e){localStorage.setItem(this.key,JSON.stringify(e.userData)),console.debug("Saved userData:",localStorage.getItem(this.key))},load:function(e){if(!localStorage.hasOwnProperty(this.key))return`${this.key} not found.`;try{var t=JSON.parse(localStorage.getItem(this.key));return Object.assign(e.userData,t),t}catch(e){return console.debug(e),confirm(`PSDLE had an issue loading user data. Would you like to reset it?\n\n${e}`)&&(this.remove(),location.reload()),e}},remove:function(){localStorage.removeItem(this.key)}},generate:{filters:{section:function(e){var t=this.button(e,"h4",this.logo(e),["psw-cell","psw-m-b-m","psdle-filter-button"],t=>this.toggleSectionVisibility(e,e.DOMElements.PSDLEconfigurator)),o=(this.button(e,"h4","Sort",["psw-cell","psw-m-b-m","psdle-filter-button","psdle-filter-sort"],e=>console.log(e)),this.button(e,"h4",`${e.lang.labels.exportView} (${e.gameList.length})`,["psw-cell","psw-m-b-m","psdle-filter-button","psdle-filter-export"],t=>this.toggleSectionVisibility(e,e.DOMElements.filterExportContainer))),r=this.sectionGroup(e,"div",e.root.generate.config.section(e,this),["psdle","psw-cell","psw-m-b-m","psw-round-m"],e.DOMElements.PSDLEconfigurator,!0),n=this.sectionGroup(e,"div",e.root.exportView.section.generate(e),["psdle","psw-cell","psw-m-b-m","psw-round-m"],e.DOMElements.filterExportContainer,!0);document.querySelector(e.DOMElements.collectionFilter).prepend(t,r,o,n)},logo:function(e){var t=document.createElement("div");return t.classList.add("psdle","psdle-logo"),t.title=`${e.version} ${e.versionDate}`,t},toggleSectionVisibility:function(e,t){var o=document.querySelector(`#${t}`);return o.style.display="none"==o.style.display?"":"none",o},sectionGroup:function(e,t,o,r,n,a){var s=document.createElement(t);return s.classList.add(...r),s.appendChild(o),s.id=n,a&&(s.style.display="none"),s},button:function(e,t,o,r,n){var a=document.createElement(t);return a.classList.add(...r),a.onclick=n,"object"==typeof o?a.appendChild(o):a.textContent=o,a}},config:{section:function(e){var t=document.createElement("div");return t.append(this.buttons(e)),t},buttons:function(e){var t=document.createElement("div");return t.append(this.helpers.rowButton(e,e.lang.labels.website,function(e){window.open("https://repod.github.io/psdle/","_blank")}),this.helpers.rowButton(e,e.lang.labels.deleteData,function(t){e.root.userData.remove(),e.root.database.drop()})),t.append(this.helpers.version(e)),t},helpers:{rowButton:function(e,t,o){var r=document.createElement("button");return r.innerText=t,r.onclick=o||(e=>console.log(e)),r},version:function(e){let t=document.createElement("span");return t.innerText=`${e.version} ${e.versionDate}`,t}}}},exportView:{section:{generate:function(e){var t=document.createElement("div");return t.append(this.optionPairs(e)),t.append(this.buttons(e)),t},refresh:function(e){let t=document.querySelector(`#${e.DOMElements.filterExportSelects}`),o=e.root.exportView.section.optionPairs(e);t.replaceWith(o),e.root.userData.save(e)},buttons:function(e){var t=document.createElement("div");return t.append(this.button(e,"＋",t=>this.addOptionPair(e)),this.button(e,"－",t=>this.removeOptionPair(e)),document.createElement("br"),this.button(e,"Import",t=>e.root.exportView.download.importExports(e)),this.button(e,"JSON",t=>e.root.exportView.download.generate(e,"JSON")),this.button(e,"CSV",t=>e.root.exportView.download.generate(e,"CSV"))),t},button:function(e,t,o){var r=document.createElement("button");return r.innerText=t,r.onclick=o||(e=>console.log(e)),r},optionPairs:function(e){var t=document.createElement("div");for(var o in t.id=e.DOMElements.filterExportSelects,e.userData.exports){var r=e.userData.exports[o];t.append(this.optionPair(e,r.title,r.property))}return t},optionPair:function(e,t,o){var r=document.createElement("span");return r.append(this.textOption(e,t),this.selectOption(e,o)),r},addOptionPair:function(e){document.querySelector(`#${e.DOMElements.filterExportSelects}`).append(this.optionPair(e)),e.root.exportView.download.saveExports(e)},removeOptionPair:function(e){var t=document.querySelectorAll(`#${e.DOMElements.filterExportSelects} span`);t.length>0&&[...t].pop().remove(),e.root.exportView.download.saveExports(e)},selectOption:function(e,t){var o=document.createElement("select");return o.onchange=(t=>this.saveOptions(e,t)),e.propCache.forEach(function(e){var r=document.createElement("option");r.value=e,r.text=e,r.selected=e===t,o.appendChild(r)}),o},textOption:function(e,t){var o=document.createElement("input");return o.onchange=(t=>this.saveOptions(e,t)),o.type="text",o.placeholder=e.lang.labels.exportEmpty,o.defaultValue=t||"",o},saveOptions:function(e){e.root.exportView.download.saveExports(e)}},download:{importExports:function(e){try{var t=JSON.parse(prompt("",JSON.stringify(e.userData.exports)));t.map(function(t){return-1==e.propCache.indexOf(t.property)&&(console.warn("Bad property?",t.property),t.property=e.propCache[0]),t}),e.userData.exports=t}catch(e){alert(e)}e.root.exportView.section.refresh(e)},saveExports:function(e){var t=[...document.querySelectorAll(`#${e.DOMElements.filterExportSelects} > span > *`)];return e.userData.exports=t.reduce((e,t,o,r)=>"SELECT"==t.nodeName?[...e,{property:t.value,title:r[o-1].value}]:e,[]),e.root.userData.save(e),e.userData.exports},generate:function(e,t){if(0==Object.keys(e.catalogCache).length){let t=e.catalogProps;if(t.length>0&&!confirm(`${e.lang.messages.exportNoProps}\n\n`+t.join(" ")))return}"CSV"==t&&this.present(e,this.format.csv.build(e,this.format.helpers),".csv"),"JSON"==t&&this.present(e,this.format.json(e,this.format.helpers),".json")},format:{helpers:{sanitize:function(e,t,o,r){switch(o){case"sortedIndex":return e.gameList.length-t.index;case"empty":return"";default:try{var n=t[o]||e.catalogCache[t.entitlementId][o];return"descriptions"==o&&(n=n.filter(e=>"LONG"==e.type).pop().value),"price"==o&&(n=e.catalogCache[t.entitlementId].price.basePrice),"image"==o&&(n=n.url),"object"==typeof n&&(n=r?n:n.map(e=>e.type?`${e.type}:${e.value}`:e.value).join(",")),"string"==typeof n&&((n=n.replace(/"/g,'""')).indexOf(",")>-1||n.indexOf('"')>-1)&&(n=`"${n}"`),n}catch(e){return console.warn(`Couldn't find ${o} in ${t.name} ${t.entitlementId}`),""}}}},json:function(e,t){var o={version:e.version,columns:e.userData.exports,items:[]};return e.gameList.forEach(function(r,n){var a={};for(var s in e.userData.exports){var i=e.userData.exports[s].property;a[i]=t.sanitize(e,{...r,index:n},i,!0)}o.items.push(a)}),JSON.stringify(o)},csv:{build:function(e,t){var o=[];return o.push(this.rowSpecial(e,"header")),e.gameList.forEach((r,n)=>o.push(this.row(e,r,n,t))),o.push(this.rowSpecial(e,"footer")),o.join("\n")},row:function(e,t,o,r){var n=[];for(var a in e.userData.exports){var s=e.userData.exports[a].property;n.push(r.sanitize(e,{...t,index:o},s))}return n.join(",")},rowSpecial:function(e,t,o){var r=[];return"header"==t&&(r=r.concat(repod.psdle.config.userData.exports.map(e=>e.title))),"footer"==t&&(r=r.concat(repod.psdle.config.userData.exports.map(e=>e.property))).push(`"${JSON.stringify(e.userData.exports).replace(/"/g,"'")}"`,e.version),r.join(",")}}},present:function(e,t,o){var r=new Blob(["\ufeff",t],{type:"octet/stream"}),n=document.createElement("a");n.download=`psdle_${(new Date).toISOString()}${o||"_generic.txt"}`,n.href=window.URL.createObjectURL(r),n.dispatchEvent(new MouseEvent("click")),window.URL.revokeObjectURL(r)}}},api:{process:{cur:0,total:0},init:async function(e){await e.catalogDatabase.persist()?e.catalogDatabase.init(e,()=>this.fetchIDs(e)):this.catalog(e)},fetchIDs:function(e){return!1},games:function(e,t){return this.fetch(e,t).then(e=>e.json()).then(e=>e.data.purchasedTitlesRetrieve.games)},catalog:async function(e,t){var o=t||e.gameList.map(e=>e.entitlementId),r=this.process;if(r.total=o.length,this.queries.catalog.hash=await this.hash(this.queries.catalog.query),0!=o.length)for(let t of o)this.call(e,"catalog",{productId:t}).then(e=>e.json()).then(function(o){r.cur+=1,e.catalogCache[t]=o.errors?null:o.data.productRetrieve;var n=Math.ceil(r.cur/r.total*100);document.querySelector(".psdle-logo").style.background=`var(--psdle-logo-clear), linear-gradient(to right, var(--blue) ${n}%, var(--darker-blue) ${n}%)`,r.cur==r.total&&e.root.api.finish(e)});else this.finish(e)},finish:async function(e){await e.catalogDatabase.persist()?e.catalogDatabase.transact.dumpCacheToDB(e,function(){e.root.caches.props(e)},!0):e.root.caches.props(e)},call:function(e,t,o){return this.fetch(e,t,o)},fetch:function(e,t,o){var r=this.buildGQLQuery(e,t,o),n=Object.entries(r).filter(e=>"query"!==e[0]).map(e=>`${e[0]}=`+("object"==typeof e[1]?encodeURIComponent(JSON.stringify(e[1])):e[1])).join("&");return fetch(`${e.gqlHost}/op?${n}`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json",Accept:"application/json","x-psn-store-locale-override":e.locale},body:JSON.stringify(r)})},buildGQLQuery:function(e,t,o){var r=this.queries[t],n={variables:o&&Object.keys(o).length>0?o:r.variables,extensions:{persistedQuery:{version:1,sha256Hash:r.hash}}};if(r.query?n.query=r.query:n.operationName=r.operationName,r.variables.platform){let t=`${e.DOMElements.collectionFilter} .psw-radio.psw-is-active .psw-radio-label`,o=document.querySelector(t).parentElement.dataset.qa.split("-").pop();r.variables.platform="all"==o?["ps4","ps5"]:[o]}return n},queries:{"recently-purchased":{operationName:"getPurchasedGameList",variables:{isActive:!0,platform:["ps4","ps5"],size:9999,sortBy:"ACTIVE_DATE",sortDirection:"desc",subscriptionService:"NONE"},hash:"00694ada3d374422aa34564e91a0589f23c5f52e0e9a703b19d065dedceb3496"},"ps-plus":{operationName:"getPurchasedGameList",variables:{platform:["ps4","ps5"],size:9999,sortBy:"ACTIVE_DATE",sortDirection:"desc",subscriptionService:"PS_PLUS"},hash:"00694ada3d374422aa34564e91a0589f23c5f52e0e9a703b19d065dedceb3496"},catalog:{query:"query queryRetrieveTelemetryDataPDPProduct($productId: String!) {\n  productRetrieve(productId: $productId) {\n    ... productFragment\n  }\n}\nfragment productFragment on Product {\n  id\n  name\n  publisherName\n  topCategory\n  releaseDate\n  descriptions {\n    type\n    value\n  }\n  compatibilityNotices {\n    type\n    value\n  }\n  media {\n    type\n    url\n    role\n  }\n  edition {\n    name\n  }\n  defaultSku {\n    id\n    name\n    type\n  }\n  skus {\n    id\n  }\n  contentRating {\n    name\n  }\n  localizedStoreDisplayClassification\n  localizedGenres {\n    value\n  }\n  price {\n    basePrice\n    discountedPrice\n    serviceBranding\n  }\n}",variables:"",hash:""}},hash:async function(e){const t=(new TextEncoder).encode(e),o=await crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(o)).map(e=>e.toString(16).padStart(2,"0")).join("")}},css:function(){var e=document.createElement("style");e.type="text/css",e.innerHTML='.psdle{--blue:#2185f4;--darker-blue:#063f7e;--bg-hover-filters:#e8e8e8;--psdle-logo-clear:url("data:image/webp;base64,UklGRnIAAABXRUJQVlA4TGUAAAAvU4AHEC9ApG1T/27Hzm6DINum/pwjuMAFBEX/R0OQbTOk+dMM4QYP8H8MbVsBRZEkNXMOAiAACUjAv6wMr3tG9H8Ckn3bhE1lUwEFhE0Nr2LzH4TNGLN5v5VtPgibV5YaT27fVgA=");--thin-padding:8px 16px}.psdle-logo{margin:0 auto;display:block;width:84px;height:31px;background-image:var(--psdle-logo-clear);background-color:var(--blue)}.psdle-filter-button{cursor:pointer}#psdle-configurator button{text-align:left;width:100%;padding:var(--thin-padding);font-weight:400!important;font-size:1rem}#psdle-configurator button:not(:last-child){border-bottom:.0625rem solid #dedede}#psdle-configurator,#psdle-filter-section-export{text-align:center;overflow:hidden;background-color:var(--bg-1)}#psdle-filter-section-export input{cursor:text}#psdle-filter-section-export select{border-style:solid;border:none;background-color:var(--bg-1);border-bottom:.0625rem solid #dedede}#psdle-filter-section-export select option{background-color:#fff}#psdle-filter-section-export input,#psdle-filter-section-export select{width:100%;padding:var(--thin-padding)}#psdle-configurator button:hover,#psdle-filter-section-export input:hover,#psdle-filter-section-export select:hover{background-color:var(--bg-hover-filters)}#psdle-filter-section-export button{padding:.2rem .3rem;margin:.3rem}#psdle-filter-section-export button:hover{color:var(--blue);background-color:var(--bg-hover-filters)}',document.getElementsByTagName("head")[0].appendChild(e)},language:{getCurrent:function(e,t){let o=Object.assign({},this.cache.en.us),r=(t||e.locale||"en-us").split("-");if(this.cache.hasOwnProperty(r[0])){let e={};if(this.cache[r[0]].hasOwnProperty(r[1]))e=this.cache[r[0]][r[1]];else{let t=this.cache[r[0]].def;console.warn(`${r[1]} not found for ${r[0]}, falling back to ${t}`),e=this.cache[r[0]][t]}Object.assign(o,e)}return o},cache:{en:{def:"us",us:{author:"",local:"English",labels:{exportView:"Export View",exportEmpty:"..?",deleteData:"Delete user data",catalogEnable:"Enable Catalog",website:"Website"},messages:{catalogFirstRun:"Your browser may prompt you for storage permissions. PSDLE will use this to store Catalog responses for quicker and automatic startup.\n\nGranting permission is only required for these benefits.",exportNoProps:"The following properties may not currently exist and could export as nothing, continue?\nThese may require running Catalog first."}}}}}},repod.psdle.init();